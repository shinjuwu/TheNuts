# TheNuts æž¶æ§‹åœ–è§£

## ðŸ“Š ç³»çµ±ç¸½è¦½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å‰ç«¯ (Frontend)                          â”‚
â”‚    Web Client / Mobile App / Desktop Client                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ WebSocket / HTTP
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Gateway Layer (ç¶²é—œå±¤)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   WebSocket  â”‚  â”‚     HTTP     â”‚  â”‚    gRPC      â”‚          â”‚
â”‚  â”‚   Handler    â”‚  â”‚   Handler    â”‚  â”‚   Handler    â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                            â”‚ Authentication (JWT)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Application Layer (æ‡‰ç”¨å±¤)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     GameService                          â”‚   â”‚
â”‚  â”‚  - CreateSession()                                       â”‚   â”‚
â”‚  â”‚  - JoinGame()                                            â”‚   â”‚
â”‚  â”‚  - HandlePlayerAction()                                  â”‚   â”‚
â”‚  â”‚  - RegisterGameEngine()                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                       â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚               TableManager (æ¡Œå­ç®¡ç†å™¨)                   â”‚  â”‚
â”‚  â”‚  - CreateTable()                                         â”‚  â”‚
â”‚  â”‚  - GetTable()                                            â”‚  â”‚
â”‚  â”‚  - CloseTable()                                          â”‚  â”‚
â”‚  â”‚  - ListTables()                                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚               â”‚               â”‚
        â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Poker Engine  â”‚ â”‚ Slot       â”‚ â”‚ Baccarat     â”‚
â”‚ (å·²å¯¦ç¾)      â”‚ â”‚ Engine     â”‚ â”‚ Engine       â”‚
â”‚               â”‚ â”‚ (å¾…å¯¦ç¾)   â”‚ â”‚ (å¾…å¯¦ç¾)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚               â”‚               â”‚
        â”‚  å¯¦ç¾ GameEngine ä»‹é¢         â”‚
        â”‚               â”‚               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Domain Layer (é ˜åŸŸå±¤)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚    Table     â”‚  â”‚    Player    â”‚  â”‚     Pot      â”‚          â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚          â”‚
â”‚  â”‚ - Run()      â”‚  â”‚ - Chips      â”‚  â”‚ - Amount     â”‚          â”‚
â”‚  â”‚ - StartHand()â”‚  â”‚ - Status     â”‚  â”‚ - Distribute()â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚    Deck      â”‚  â”‚  Evaluator   â”‚  â”‚ Distributor  â”‚          â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚          â”‚
â”‚  â”‚ - Shuffle()  â”‚  â”‚ - Evaluate() â”‚  â”‚ - Deal()     â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Infrastructure Layer (åŸºç¤Žè¨­æ–½å±¤)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  PostgreSQL  â”‚  â”‚     Redis    â”‚  â”‚  RNG Service â”‚          â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚          â”‚
â”‚  â”‚ - Players    â”‚  â”‚ - Sessions   â”‚  â”‚ - crypto/randâ”‚          â”‚
â”‚  â”‚ - Games      â”‚  â”‚ - Cache      â”‚  â”‚              â”‚          â”‚
â”‚  â”‚ - HandHistoryâ”‚  â”‚ - Pub/Sub    â”‚  â”‚              â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Wallet       â”‚  â”‚  Audit Log   â”‚  â”‚  Monitoring  â”‚          â”‚
â”‚  â”‚ Service      â”‚  â”‚              â”‚  â”‚              â”‚          â”‚
â”‚  â”‚              â”‚  â”‚ - All Actionsâ”‚  â”‚ - Prometheus â”‚          â”‚
â”‚  â”‚ - Deduct()   â”‚  â”‚ - Timestamps â”‚  â”‚ - Grafana    â”‚          â”‚
â”‚  â”‚ - Credit()   â”‚  â”‚              â”‚  â”‚              â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ðŸ”„ æ•¸æ“šæµåœ–

### çŽ©å®¶åŠ å…¥éŠæˆ²æµç¨‹

```
Frontend                  Gateway              GameService           PokerEngine          Database
   â”‚                        â”‚                      â”‚                     â”‚                   â”‚
   â”œâ”€ JoinGame Request â”€â”€â”€â”€>â”‚                      â”‚                     â”‚                   â”‚
   â”‚  {gameID, buyIn}       â”‚                      â”‚                     â”‚                   â”‚
   â”‚                        â”œâ”€ Authenticate â”€â”€â”€â”€â”€â”€â”€>â”‚                     â”‚                   â”‚
   â”‚                        â”‚  (JWT Token)         â”‚                     â”‚                   â”‚
   â”‚                        â”‚                      â”œâ”€ Check Balance â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                        â”‚                      â”‚                     â”‚                   â”‚
   â”‚                        â”‚                      â”‚<â”€â”€â”€â”€ Balance OK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                        â”‚                      â”‚                     â”‚                   â”‚
   â”‚                        â”‚                      â”œâ”€ Deduct Chips â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                        â”‚                      â”‚                     â”‚                   â”‚
   â”‚                        â”‚                      â”œâ”€ AddPlayer() â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
   â”‚                        â”‚                      â”‚                     â”‚                   â”‚
   â”‚                        â”‚                      â”‚                     â”œâ”€ Find Empty Seat  â”‚
   â”‚                        â”‚                      â”‚                     â”œâ”€ Create Player    â”‚
   â”‚                        â”‚                      â”‚                     â”œâ”€ Broadcast Event  â”‚
   â”‚                        â”‚                      â”‚                     â”‚                   â”‚
   â”‚                        â”‚                      â”‚<â”€â”€ Success â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚
   â”‚                        â”‚<â”€â”€ JoinGame Result â”€â”€â”¤                     â”‚                   â”‚
   â”‚<â”€ Response â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚                     â”‚                   â”‚
   â”‚  {success, seatIdx}    â”‚                      â”‚                     â”‚                   â”‚
   â”‚                        â”‚                      â”‚                     â”‚                   â”‚
```

### çŽ©å®¶å‹•ä½œè™•ç†æµç¨‹

```
Frontend         WebSocket          GameService        PokerEngine         Table (Domain)
   â”‚                 â”‚                   â”‚                  â”‚                    â”‚
   â”œâ”€ Action â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚                  â”‚                    â”‚
   â”‚  {raise, 100}   â”‚                   â”‚                  â”‚                    â”‚
   â”‚                 â”œâ”€ HandleAction â”€â”€â”€>â”‚                  â”‚                    â”‚
   â”‚                 â”‚                   â”œâ”€ GetTable() â”€â”€â”€â”€>â”‚                    â”‚
   â”‚                 â”‚                   â”‚                  â”‚                    â”‚
   â”‚                 â”‚                   â”‚                  â”œâ”€ ActionCh <- â”€â”€â”€â”€â”€>â”‚
   â”‚                 â”‚                   â”‚                  â”‚    PlayerAction    â”‚
   â”‚                 â”‚                   â”‚                  â”‚                    â”œâ”€ Validate
   â”‚                 â”‚                   â”‚                  â”‚                    â”œâ”€ Update State
   â”‚                 â”‚                   â”‚                  â”‚                    â”œâ”€ Check Round End
   â”‚                 â”‚                   â”‚                  â”‚                    â”‚
   â”‚                 â”‚                   â”‚                  â”‚<â”€â”€â”€ Event â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                 â”‚                   â”‚                  â”‚   (StateChange)    â”‚
   â”‚                 â”‚                   â”‚                  â”‚                    â”‚
   â”‚                 â”‚                   â”‚                  â”œâ”€ BroadcastEvent() â”‚
   â”‚                 â”‚                   â”‚                  â”‚                    â”‚
   â”‚                 â”‚<â”€â”€â”€ EventCh â”€â”€â”€â”€â”€â”€â”¤<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
   â”‚<â”€ Broadcast â”€â”€â”€â”€â”¤                   â”‚                  â”‚                    â”‚
   â”‚  {type, data}   â”‚                   â”‚                  â”‚                    â”‚
```

## ðŸŽ® éŠæˆ²å¼•æ“Žä»‹é¢å¯¦ç¾å°æ¯”

### Poker Engine (å¾·å·žæ’²å…‹)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         PokerEngine (é©é…å™¨)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + GetType(): GameTypePoker             â”‚
â”‚ + HandleAction(): è½‰æ›ç‚º domain.Action â”‚
â”‚ + AddPlayer(): åˆ†é…åº§ä½                â”‚
â”‚ + BroadcastEvent(): è¦–è§’éŽæ¿¾           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ å¾©ç”¨ç¾æœ‰é‚è¼¯
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         domain.Table (æ ¸å¿ƒé‚è¼¯)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + Run(): ä¸»å¾ªç’°                        â”‚
â”‚ + handleAction(): è™•ç†ä¸‹æ³¨/æ£„ç‰Œ        â”‚
â”‚ + nextStreet(): ç‹€æ…‹è½‰æ›               â”‚
â”‚ + StartHand(): æ´—ç‰Œç™¼ç‰Œ                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Slot Engine (è€è™Žæ©Ÿ - å¾…å¯¦ç¾)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           SlotEngine (æ–°å¼•æ“Ž)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + GetType(): GameTypeSlot              â”‚
â”‚ + HandleAction(ActionSpin):            â”‚
â”‚   - ç”Ÿæˆéš¨æ©Ÿæ»¾è¼ªçµæžœ                   â”‚
â”‚   - è¨ˆç®—çŽé‡‘                           â”‚
â”‚   - æ‰£é™¤/å¢žåŠ çŽ©å®¶é¤˜é¡                  â”‚
â”‚ + AddPlayer(): å–®äººéŠæˆ²                â”‚
â”‚ + BroadcastEvent(): ç™¼é€çµæžœ           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å…§éƒ¨ç‹€æ…‹:                             â”‚
â”‚  - reels [][]Symbol                    â”‚
â”‚  - payTable map[Combination]int        â”‚
â”‚  - rtp float64 (Return to Player)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ðŸ—‚ï¸ ç›®éŒ„çµæ§‹

```
TheNuts/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ game-server/
â”‚       â””â”€â”€ main.go              # ä¸»ç¨‹åºå…¥å£
â”‚
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ game/
â”‚   â”‚   â”œâ”€â”€ core/                # â­ æ ¸å¿ƒæ¡†æž¶å±¤ (æ–°å¢ž)
â”‚   â”‚   â”‚   â”œâ”€â”€ game_engine.go   # GameEngine ä»‹é¢å®šç¾©
â”‚   â”‚   â”‚   â”œâ”€â”€ table_manager.go # æ¡Œå­ç®¡ç†å™¨
â”‚   â”‚   â”‚   â””â”€â”€ service.go       # GameService çµ±ä¸€å…¥å£
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ poker/               # â­ å¾·æ’²å¼•æ“Ž (æ–°å¢ž)
â”‚   â”‚   â”‚   â””â”€â”€ poker_engine.go  # å¯¦ç¾ GameEngine ä»‹é¢
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ slot/                # â³ è€è™Žæ©Ÿå¼•æ“Ž (æœªä¾†)
â”‚   â”‚   â”‚   â””â”€â”€ slot_engine.go
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ domain/              # âœ… ç¾æœ‰å¾·æ’²é‚è¼¯ (ä¿ç•™)
â”‚   â”‚   â”‚   â”œâ”€â”€ table.go
â”‚   â”‚   â”‚   â”œâ”€â”€ player.go
â”‚   â”‚   â”‚   â”œâ”€â”€ pot.go
â”‚   â”‚   â”‚   â”œâ”€â”€ deck.go
â”‚   â”‚   â”‚   â””â”€â”€ evaluator.go
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ adapter/
â”‚   â”‚       â””â”€â”€ ws/              # WebSocket é©é…å™¨
â”‚   â”‚           â”œâ”€â”€ handler.go   # éœ€æ”¹ç”¨ GameService
â”‚   â”‚           â”œâ”€â”€ client.go
â”‚   â”‚           â””â”€â”€ hub.go
â”‚   â”‚
â”‚   â””â”€â”€ infra/                   # åŸºç¤Žè¨­æ–½å±¤
â”‚       â”œâ”€â”€ database/            # æ•¸æ“šåº«è¨ªå•
â”‚       â”œâ”€â”€ cache/               # Redis ç·©å­˜
â”‚       â””â”€â”€ logger/              # æ—¥èªŒ
â”‚
â”œâ”€â”€ pkg/                         # å¯å¾©ç”¨çš„å…¬å…±åŒ…
â”‚   â”œâ”€â”€ poker/                   # å¾·æ’²é€šç”¨ç®—æ³•
â”‚   â””â”€â”€ errors/                  # éŒ¯èª¤è™•ç†
â”‚
â”œâ”€â”€ docs/                        # â­ æ–‡æª” (æ–°å¢ž)
â”‚   â”œâ”€â”€ ARCHITECTURE.md          # æž¶æ§‹è¨­è¨ˆ
â”‚   â”œâ”€â”€ MIGRATION_GUIDE.md       # é·ç§»æŒ‡å—
â”‚   â”œâ”€â”€ QUICK_START.md           # å¿«é€Ÿé–‹å§‹
â”‚   â””â”€â”€ ARCHITECTURE_DIAGRAM.md  # æž¶æ§‹åœ–è§£
â”‚
â”œâ”€â”€ examples/                    # â­ ç¤ºä¾‹ä»£ç¢¼ (æ–°å¢ž)
â”‚   â””â”€â”€ multi_game_example.go
â”‚
â”œâ”€â”€ CODE_REVIEW.md               # ä»£ç¢¼å¯©æŸ¥å ±å‘Š
â”œâ”€â”€ TODO.md                      # â­ å¾…è¾¦æ¸…å–® (æ–°å¢ž)
â””â”€â”€ go.mod
```

## ðŸ”Œ æ“´å±•é»žè¨­è¨ˆ

### 1. æ–°å¢žéŠæˆ²é¡žåž‹

```go
// 1. åœ¨ game_engine.go æ·»åŠ æ–°é¡žåž‹
const GameTypeBaccarat GameType = "baccarat"

// 2. å‰µå»ºæ–°å¼•æ“Ž
type BaccaratEngine struct { ... }
func (e *BaccaratEngine) GetType() GameType { return GameTypeBaccarat }

// 3. è¨»å†Šå¼•æ“Ž
gameService.RegisterGameEngine(GameTypeBaccarat, &BaccaratEngineFactory{})
```

### 2. æ–°å¢žå‹•ä½œé¡žåž‹

```go
// åœ¨ game_engine.go æ·»åŠ 
const ActionDouble ActionType = "double"  // ç™¾å®¶æ¨‚åŠ å€

// åœ¨å°æ‡‰å¼•æ“Žä¸­è™•ç†
func (e *BaccaratEngine) HandleAction(action PlayerAction) {
    switch action.Type {
    case ActionDouble:
        // è™•ç†åŠ å€é‚è¼¯
    }
}
```

### 3. æ–°å¢žäº‹ä»¶é¡žåž‹

```go
// åœ¨ game_engine.go æ·»åŠ 
const EventDealerAction EventType = "dealer_action"  // è¦–è¨ŠéŠæˆ²å°ˆç”¨

// å»£æ’­äº‹ä»¶
engine.BroadcastEvent(GameEvent{
    EventType: EventDealerAction,
    Data: map[string]interface{}{
        "action": "deal_card",
    },
})
```

## ðŸŽ¯ é—œéµè¨­è¨ˆæ±ºç­–

### ç‚ºä»€éº¼é¸æ“‡é€™å€‹æž¶æ§‹ï¼Ÿ

1. **é–‹æ”¾å°é–‰åŽŸå‰‡ (Open-Closed Principle)**
   - å°æ“´å±•é–‹æ”¾ï¼šæ–°å¢žéŠæˆ²ç„¡éœ€ä¿®æ”¹æ ¸å¿ƒä»£ç¢¼
   - å°ä¿®æ”¹å°é–‰ï¼šç¾æœ‰éŠæˆ²é‚è¼¯ä¸å—å½±éŸ¿

2. **ä¾è³´å€’ç½®åŽŸå‰‡ (Dependency Inversion)**
   - é«˜å±¤æ¨¡çµ„ (GameService) ä¸ä¾è³´ä½Žå±¤æ¨¡çµ„ (PokerEngine)
   - éƒ½ä¾è³´æŠ½è±¡ (GameEngine ä»‹é¢)

3. **å–®ä¸€è·è²¬åŽŸå‰‡ (Single Responsibility)**
   - GameService: ç®¡ç†æœƒè©±å’Œè·¯ç”±
   - TableManager: ç®¡ç†æ¡Œå­ç”Ÿå‘½é€±æœŸ
   - PokerEngine: è™•ç†å¾·æ’²æ¥­å‹™é‚è¼¯

4. **ä»‹é¢éš”é›¢åŽŸå‰‡ (Interface Segregation)**
   - GameEngine ä»‹é¢åªå®šç¾©é€šç”¨æ–¹æ³•
   - éŠæˆ²å°ˆå±¬æ–¹æ³•æ”¾åœ¨å…·é«”å¯¦ç¾ä¸­

## ðŸ“ˆ æ€§èƒ½è€ƒé‡

### ä½µç™¼æ¨¡åž‹

```
æ¯å€‹ GameEngine å¯¦ä¾‹:
  - å–®ç¨çš„ Goroutine é‹è¡Œ Start()
  - å…§éƒ¨ä½¿ç”¨ Channel é¿å…ç«¶æ…‹æ¢ä»¶
  - äº‹ä»¶å»£æ’­ä½¿ç”¨éžé˜»å¡ž select

é æœŸæ”¯æ´è¦æ¨¡:
  - 1000+ ä¸¦ç™¼æ¡Œå­
  - 10000+ ä¸¦ç™¼çŽ©å®¶
  - å¹³å‡å»¶é² < 50ms
```

### å…§å­˜å„ªåŒ–

- ä½¿ç”¨ `sync.Pool` å¾©ç”¨ Player/Action å°è±¡
- éŠæˆ²çµæŸå¾ŒåŠæ™‚é‡‹æ”¾è³‡æº
- ä½¿ç”¨ Protobuf æ¸›å°‘åºåˆ—åŒ–é–‹éŠ·

## ðŸ” å®‰å…¨è¨­è¨ˆ

### è¦–è§’éŽæ¿¾

```go
// å»£æ’­æ™‚æ ¹æ“šçŽ©å®¶IDéŽæ¿¾æ•¸æ“š
if event.TargetPlayerID == "" {
    // å…¬å…±äº‹ä»¶ï¼šæ‰€æœ‰äººéƒ½çœ‹åˆ°ç›¸åŒæ•¸æ“š
} else {
    // ç§äººäº‹ä»¶ï¼šåªæœ‰ç›®æ¨™çŽ©å®¶èƒ½çœ‹åˆ°
    if client.PlayerID == event.TargetPlayerID {
        client.SendCh <- serialize(event)
    }
}
```

### å‹•ä½œé©—è­‰

```go
// æ¯å€‹å¼•æ“Žå¿…é ˆé©—è­‰
1. æ˜¯å¦è¼ªåˆ°è©²çŽ©å®¶ï¼Ÿ
2. å‹•ä½œæ˜¯å¦åˆæ³•ï¼Ÿ
3. é‡‘é¡æ˜¯å¦è¶³å¤ ï¼Ÿ
4. æ˜¯å¦åœ¨æ­£ç¢ºçš„éŠæˆ²éšŽæ®µï¼Ÿ
```

---

**æœ€å¾Œæ›´æ–°**: 2026-01-22  
**ç‰ˆæœ¬**: v1.0  
**ç¶­è­·è€…**: TheNuts é–‹ç™¼åœ˜éšŠ
